// Copyright Â© 2013, 2014, Watu
function Portfolio(t){var e=this;e.$form=t,e.$selectedFields=t.find(".fields ol"),e.$availableFields=t.find(".available_fields ul"),e.$fields=t.find("input#portfolio_fields"),$(e.$selectedFields).sortable({connectWith:".connected_sortable",placeholder:"ui-state-highlight",dropOnEmpty:!0,update:function(){e.updateFields()}}).disableSelection(),e.$availableFields.find("li").draggable({connectToSortable:e.$selectedFields,helper:"clone"}),e.$availableFields.droppable({drop:function(t){$(t.srcElement).remove(),e.updateFields()}})}Portfolio.prototype.updateFields=function(){var t=this,e=t.$selectedFields.find("li.field_item").map(function(t,e){return $(e).data("name")}).get().join(",");t.$fields.val(e)},Portfolio.displayAddToPortfolioDialog=function(t,e){var i=e.title||"Add staffer to portfolio";e||(e={}),$.ajax(t).done(function(t){var n=$("#add_staffer_to_portfolio_dialog");0==n.length&&(n=$('<div id="add_staffer_to_portfolio_dialog"></div>')),n.html(t.form),$(n.find("form.add_staffer_to_portfolio")).bind("ajax:success",function(t,i){var s="added"==i.status?"notice":"alert";n.dialog("close"),showFlashMessage(i.message,s);var o=$("header nav.main .portfolios");o.stop(!0,!0).css("top","auto"),window.setTimeout(function(){o.effect("bounce",{},"fast")},0),"function"==typeof e.fnSuccess&&e.fnSuccess()}).disable_double_submit(""),n.watu_dialog({modal:!0,width:750,title:i})}).fail(function(){alert("There was an unexpected error.")})},$(document).ready(function(){$(".best_in_place").best_in_place(),$("ul.portfolio_cards li.portfolio_card a.remove_card").bind("ajax:success",function(){var t=$($(this).parents("li.portfolio_card"));console.log("Getting rid of",t),t.effect("blind")}).bind("ajax:error",function(){alert("There was an unexpected error")}),$("form.portfolio").each(function(){new Portfolio($(this))}),$("a.add_to_portfolio_dialog").click(function(t){t.preventDefault();var e=$(this).attr("href"),i=$(this).data("title");Portfolio.displayAddToPortfolioDialog(e,{title:i})})});