// Copyright Â© 2012, 2013, 2014, Watu
var UsersList={init:function(){UsersList.getItems().click(function(t){t&&t.target&&($(t.target).is("a")||$(t.target).parents().is("a"))||UsersList.toggleSelect(this)}),$("ol.users.selectable li a").hover(function(){$(this).parents("li").addClass("hovering_over_link")},function(){$(this).parents("li").removeClass("hovering_over_link")}),$(".action_bar .select_these").click(UsersList.selectThese),$(".action_bar .select_none").click(UsersList.selectNone),UsersList.bindActionButtonClick("add_to_job",AddToJobDialog.show),UsersList.bindActionButtonClick("message",function(t,e){Message.displayNewMessageDialog(t,{fnSuccess:e})}),UsersList.bindActionButtonClick("multi_add_to_portfolio_dialog",function(t,e){Portfolio.displayAddToPortfolioDialog(t,{title:"Add selected staffers to portfolio",fnSuccess:e})}),UsersList.bindActionButtonClick("shortlist",UsersList.shortlist),UsersList.bindActionButtonClick("unshortlist",UsersList.unshortlist),$(".action_bar .action[tooltip_content]").each(function(){$(this).data("original_tooltip_content",$(this).attr("tooltip_content"))}),$(".action_bar").not(".main_action_bar .action_bar").followScroll(),UsersList.updateSelectedCounter()},bindActionButtonClick:function(t,e){$(".action_bar .action."+t).click(function(t){t.preventDefault();var i=$(this).attr("href"),n=-1==i.indexOf("?")?"?":"&",s=UsersList.getSelectedRIDs();if(s.length>0)i+=n+"rids="+s;else{if(!($(this).hasClass("applies_to_all")&&$.QueryString.q&&$.QueryString.q.length>0))return;i+=n+"q="+$.QueryString.q}e(i,UsersList.selectNone)})},getItems:function(){return $("ol.users.selectable li")},getSelectedCards:function(){return $("ol.users.selectable li.selected")},getSelectedRIDs:function(){return $.makeArray(UsersList.getSelectedCards().map(function(t,e){return $(e).data("rid")}))},selectAllCards:function(t){UsersList.getItems().set_class_if(t,"selected")},selectThese:function(){return UsersList.selectAllCards(!0),UsersList.updateSelectedCounter(),!1},selectNone:function(){return UsersList.selectAllCards(!1),UsersList.updateSelectedCounter(),!1},toggleSelect:function(t){$(t).toggleClass("selected"),UsersList.updateSelectedCounter()},updateSelectedCounter:function(){var t=UsersList.getSelectedRIDs(),e=$(".action_bar a.action").not(".applies_to_all");e.set_class_if(0==t.length,"disabled"),e.filter(".book_to_job").set_class_if(0==t.length||t.length>1,"disabled"),e.each(function(){var e=$(this);0==t.length?e.attr("tooltip_content","You must select some staffers to use this tool."):e.hasClass("book_to_job")&&t.length>1?e.attr("tooltip_content","You can only book one staffer at a time."):$(this).data("original_tooltip_content")?e.attr("tooltip_content",$(this).data("original_tooltip_content")):e.attr("tooltip_content","")}),attachTooltips(".action_bar"),$(".action_bar span.with_selected .count").html(t.length),$(".action_bar span.none_selected").show_if(0==t.length),$(".action_bar span.with_selected").show_if(t.length>0)},shortlist:function(t,e){return $.ajax({url:t,dataType:"json",type:"POST"}).done(function(t){UsersList.updateShortlistCounter(t.shortlisted_staffers_count),showFlashMessage(t.success_message),"function"==typeof e&&e(t)}).fail(function(){alert("There was an unexpected error.")}),!1},unshortlist:function(t,e){if($("body").hasClass("shortlists_show")&&UsersList.getSelectedCards().length==UsersList.getItems().length){if(!confirm("Are you sure you want to empty your shortlist?"))return!1}else if($("body").hasClass("shortlists_show")&&UsersList.getSelectedCards().length>UsersList.getItems().length/2&&!confirm("Are you sure you want to unshortlist "+UsersList.getSelectedCards().length+" staffers?"))return!1;return $.ajax({url:t,dataType:"json",type:"POST"}).done(function(t){UsersList.updateShortlistCounter(t.shortlisted_staffers_count),UsersList.getSelectedCards().fadeOut(function(){$(this).remove()}),showFlashMessage(t.success_message),"function"==typeof e&&e(t)}).fail(function(){alert("There was an unexpected error.")}),!1},updateShortlistCounter:function(t){$("span.shortlist_count").html(t),$("body.shortlists .action_bar a.select_these span").html(t),0==t&&$("body").hasClass("shortlists_show")&&window.location.reload();var e=$("header nav.main .shortlist");e.stop(!0,!0).css("top","auto"),window.setTimeout(function(){e.effect("bounce",{},"fast")},0)}};$(document).ready(function(){$("ol.users.selectable").size()>0&&UsersList.init()});