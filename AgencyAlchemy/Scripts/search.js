// Copyright Â© 2012, 2013, 2014, Watu
function Searcher(t){this.elQuery=t.find("#q"),this.fields=this.elQuery.data("fields"),this.distance_unit=this.elQuery.data("distance-unit"),this.country=this.elQuery.data("country");var e={prePopulate:this.elQuery.data("value"),searchDelay:0,theme:"facebook",zindex:999,commaSelectsToken:!1,animateDropdown:!1,tokenDelimiter:"\u222b"},i=this;this.elQuery.tokenInput(function(t,e){i.auto_complete(t,e)},e)}Searcher.prototype.highlight_term=function(t,e){if(null==e||""==e)return t;var i=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),n=e.replace(i,"\\$&");return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")},Searcher.prototype.auto_complete=function(t,e){var i=this,n=[{id:"*\u2192"+t,name:html_escape(t)}],s=$.trim(t),o=s;i.country&&o.indexOf(",")<0&&(o+=", "+i.country);var a=s.toLowerCase(),r=a.split(/:(.*)/),l=null,c=null;r.length>=2&&(l=$.trim(r[0]),c=$.trim(r[1]));var u="registering";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192registering",name:"State: registering"});var u="imported";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192imported",name:"State: imported"});var u="pending";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192pending",name:"State: pending"});var u="active";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192active",name:"State: active"});var u="suspended";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192suspended",name:"State: suspended"});var u="rejected";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192rejected",name:"State: rejected"});var u="canceled";(u.indexOf(a)>=0||"state".indexOf(a)>=0||"state".indexOf(l)>=0&&u.indexOf(c)>=0)&&n.push({id:"state\u2192canceled",name:"State: canceled"}),$.each(i.fields,function(t,e){switch(e.type){case"check_box":if(e.title.toLowerCase().indexOf(a)>=0||e.title.toLowerCase().indexOf(l)>=0){if(null==c||"yes".indexOf(c)>=0){var s=e.name+"\u2192true",o=html_escape(i.highlight_term(e.title,l)+i.highlight_term(": Yes",c));n.push({id:s,name:o})}if(null==c||"no".indexOf(c)>=0){var s=e.name+"\u2192false",o=html_escape(i.highlight_term(e.title,l)+i.highlight_term(": No",c));n.push({id:s,name:o})}}break;case"choice":case"multi_choice":case"role":e.title.toLowerCase().indexOf(a)>=0||e.title.toLowerCase().indexOf(l)>=0?$.each(e.options,function(t,s){if(null==c||s.title.indexOf(c)>=0){var o=e.name+"\u2192"+s.name,a=html_escape(i.highlight_term(e.title,l)+i.highlight_term(": "+s.title,c));n.push({id:o,name:a})}}):$.each(e.options,function(t,i){if(i.title.toLowerCase().indexOf(a)>=0){var s=e.name+"\u2192"+i.name,o=html_escape(e.title+": "+i.title);n.push({id:s,name:o})}})}}),"miles"==i.distance_unit?(n.push({id:"address\u219210\u21a3"+o,name:"Address: within 10 miles of "+html_escape(o)}),n.push({id:"address\u219220\u21a3"+o,name:"Address: within 20 miles of "+html_escape(o)}),n.push({id:"address\u219250\u21a3"+o,name:"Address: within 50 miles of "+html_escape(o)}),n.push({id:"address\u2192100\u21a3"+o,name:"Address: within 100 miles of "+html_escape(o)})):(n.push({id:"address\u219210\u21a3"+o,name:"Address: within 10km of "+html_escape(o)}),n.push({id:"address\u219220\u21a3"+o,name:"Address: within 20km of "+html_escape(o)}),n.push({id:"address\u219250\u21a3"+o,name:"Address: within 50km of "+html_escape(o)}),n.push({id:"address\u2192100\u21a3"+o,name:"Address: within 100km of "+html_escape(o)})),e(t,n)},$(document).ready(function(){$("form.search").each(function(t,e){new Searcher($(e))})});